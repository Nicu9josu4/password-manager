<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Parole</title>
    <link rel="stylesheet" href="style.css">
    <!-- Nu include script.js aici! -->
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <nav>
                <ul style="list-style:none;padding-left:0;">
                    <li style="margin-bottom:12px;padding:0;list-style:none;">
                        <button id="nav-all" class="sidebar-nav-btn" style="width:100%;padding:12px 0 12px 12px;text-align:left;background:none;border:none;font-weight:600;font-size:1.08em;cursor:pointer;border-radius:8px;transition:background 0.2s, color 0.2s;">Toate parolele</button>
                    </li>
                    <li style="padding:0;list-style:none;">
                        <button id="nav-history" class="sidebar-nav-btn" style="width:100%;padding:12px 0 12px 12px;text-align:left;background:none;border:none;font-weight:600;font-size:1.08em;cursor:pointer;border-radius:8px;transition:background 0.2s, color 0.2s;">Istoricul cererilor</button>
                    </li>
                </ul>
            </nav>
        </aside>
        <main class="main-content">
            <header class="header-bar left-actions">
                <div class="header-actions">
                    <button id="create-btn" class="modern-btn primary-btn" style="display: inline-block;">Creare articol</button>
                    <button id="logout-btn" class="modern-btn logout-btn">Logout</button>
                </div>
            </header>
            <section id="password-list">
                <!-- Articolele/parolele sau istoricul vor fi generate aici din JS -->
            </section>
        </main>
    </div>
    <style>
        .sidebar-nav-btn {
            color: #e3e6f3;
            background: none;
            border: none;
            font-weight: 600;
            font-size: 1.08em;
            cursor: pointer;
            border-radius: 8px;
            width: 100%;
            padding: 12px 0 12px 12px;
            text-align: left;
            transition: background 0.2s, color 0.2s;
        }

            .sidebar-nav-btn.active, .sidebar-nav-btn:focus {
                background: #31333c;
                color: #fff;
                outline: none;
            }

            .sidebar-nav-btn:hover {
                background: #23283a;
                color: #b8c2e0;
            }
    </style>
    <script src="~/js/script.js"></script>
    <script>
        document.getElementById('logout-btn').addEventListener('click', function() {
        window.location.href = '/login';
        });
        // Navigare între secțiuni
        document.getElementById('nav-all').onclick = function() {
            document.getElementById('nav-all').classList.add('active');
            document.getElementById('nav-history').classList.remove('active');
            // Afișează secțiunea parolelor și ascunde istoricul cererilor dacă există
            document.getElementById('password-list').style.display = '';
            var reqSection = document.getElementById('request-history-section');
            if (reqSection) reqSection.style.display = 'none';
            document.getElementById('create-btn').style.display = 'inline-block';
            if (typeof renderPasswords === 'function') {
                renderPasswords(getPasswords());
            } else {
                document.getElementById('password-list').innerHTML = '<div style="color:red;font-weight:bold;">Eroare: funcția renderPasswords nu este definită!</div>';
            }
        };
        document.getElementById('nav-history').onclick = function() {
            document.getElementById('nav-history').classList.add('active');
            document.getElementById('nav-all').classList.remove('active');
            // Ascunde secțiunea parolelor și arată doar istoricul cererilor
            document.getElementById('password-list').style.display = 'none';
            // Creează sau arată secțiunea pentru istoricul cererilor
            let reqSection = document.getElementById('request-history-section');
            if (!reqSection) {
                reqSection = document.createElement('section');
                reqSection.id = 'request-history-section';
                reqSection.style.marginTop = '32px';
                document.querySelector('.main-content').appendChild(reqSection);
            }
            reqSection.style.display = '';
            document.getElementById('create-btn').style.display = 'none';
            // Dacă există cereri, afișează direct lista; altfel, arată doar mesajul informativ
            let history = JSON.parse(localStorage.getItem('requestHistory')||'[]');
            reqSection.innerHTML = '<h3 style="color:#b8c2e0;margin-bottom:18px;">Istoricul cererilor</h3>';
            if (history.length > 0 && typeof renderRequestHistory === 'function') {
                history.slice().reverse().forEach((item, idx, arr) => {
                    const div = document.createElement('div');
                    div.className = 'request-history-item';
                    div.style = 'background:#181c2f;border-radius:18px;padding:24px 28px 18px 28px;margin-bottom:24px;box-shadow:0 2px 16px #0003;max-width:600px;color:#b8c2e0;cursor:pointer;position:relative;';
                    const realIdx = history.length - 1 - idx;
                    div.innerHTML = `
                        <div style=\"font-size:1.25em;font-weight:700;color:#8faaff;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;\">
                            <span>${item.nume || item.mesaj || 'Cerere acces parole'}</span>
                            <span class='delete-request-btn' title='Șterge cererea' style='color:#e57373;cursor:pointer;font-size:1.3em;margin-left:12px;user-select:none;'>&#128465;</span>
                        </div>
                        ${item.scop ? `<div style='margin-bottom:2px;'><b>Scop:</b> <span style='color:#fff;'>${item.scop}</span></div>` : ''}
                        ${item.detalii ? `<div style='margin-bottom:2px;'><b>Detalii:</b> <span style='color:#fff;'>${item.detalii}</span></div>` : ''}
                        ${item.prioritate ? `<div style='margin-bottom:2px;'><b>Prioritate:</b> <span style='color:${getPriorityColor(item.prioritate)};'>${item.prioritate}</span></div>` : ''}
                        <div style='margin-top:6px;font-size:0.98em;color:#a0a8c3;'><b>Data:</b> ${item.data || '-'}</div>
                    `;
                    div.onclick = function(e) {
                        if (e.target.classList.contains('delete-request-btn')) return;
                        window.open(`/adminRequest?request=${realIdx}`, '_blank');
                    };
                    div.querySelector('.delete-request-btn').onclick = function(e) {
                        e.stopPropagation();
                        if (confirm('Sigur vrei să ștergi această cerere din istoric?')) {
                            const hist = JSON.parse(localStorage.getItem('requestHistory')||'[]');
                            hist.splice(realIdx, 1);
                            localStorage.setItem('requestHistory', JSON.stringify(hist));
                            document.getElementById('nav-history').onclick();
                        }
                    };
                    reqSection.appendChild(div);
                });
            } else {
                reqSection.innerHTML += '<div style="color:#888;padding:2em;">Nicio cerere salvată.</div>';
            }
        };
        // Dialog modern pentru creare articol (stil Bitwarden)
        document.getElementById('create-btn').addEventListener('click', function() {
            if (document.querySelector('.modal')) return;
            const modalBg = document.createElement('div');
            modalBg.className = 'modal';
            modalBg.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(20,22,30,0.85);z-index:1000;display:flex;align-items:center;justify-content:center;';
            modalBg.innerHTML = `
            <div class="modal-content" style="background:#232533;color:#e3e6f3;border-radius:18px;padding:36px 36px 24px 36px;min-width:400px;max-width:95vw;box-shadow:0 8px 32px #0008;position:relative;display:flex;flex-direction:column;gap:24px;">
                <span class="close" onclick="document.querySelector('.modal').remove()" style="position:absolute;top:18px;right:24px;font-size:2rem;cursor:pointer;color:#bbb;">&times;</span>
                <h2 style="margin-top:0;margin-bottom:18px;font-size:1.5em;font-weight:700;letter-spacing:0.01em;">New Conectare</h2>
                <form id="addItemForm" class="styled-form" style="display:flex;flex-direction:column;gap:24px;">
                    <div style="background:#23283a;border-radius:12px;padding:18px 24px 12px 24px;display:flex;align-items:center;gap:18px;box-shadow:0 2px 8px #0002;">
                        <div style="flex:1;min-width:0;">
                            <input type="text" id="itemName" placeholder="Nume Item:" required style="font-size:1.25em;font-weight:700;color:#6d8cff;background:none;border:none;outline:none;width:100%;padding:0;">
                        </div>
                    </div>
                    <div style="display:flex;gap:24px;flex-wrap:wrap;">
                        <div style="flex:1;min-width:220px;background:#23283a;border-radius:10px;padding:18px 18px 8px 18px;box-shadow:0 2px 8px #0002;">
                            <div style="font-weight:600;margin-bottom:0.5em;">Date de logare</div>
                            <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
                                <input type="text" id="itemUser" placeholder="Nume utilizator" style="background:#191b26;color:#e3e6f3;font-size:1em;border:none;border-radius:7px;padding:8px 10px;width:100%;">
                            </div>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <input type="password" id="itemPassword" placeholder="Parolă" style="background:#191b26;color:#e3e6f3;font-size:1em;border:none;border-radius:7px;padding:8px 10px;width:100px;">
                                <button type="button" class="icon-btn" id="pwToggleBtn" tabindex="-1" style="background:none;border:none;color:#8ab4f8;font-size:1.1em;cursor:pointer;">👁️</button>
                                <button type="button" class="icon-btn" id="pwGenBtn" title="Generează parolă" tabindex="-1" style="background:none;border:none;color:#8ab4f8;font-size:1.1em;cursor:pointer;">&#x21bb;</button>
                            </div>
                        </div>
                        <div style="flex:1;min-width:220px;background:#23283a;border-radius:10px;padding:18px 18px 8px 18px;box-shadow:0 2px 8px #0002;">
                            <div style="font-weight:600;margin-bottom:0.5em;">Completare automată</div>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <input type="text" id="itemSite" placeholder="Site web (URI)" style="background:#191b26;color:#e3e6f3;font-size:1em;border:none;border-radius:7px;padding:8px 10px;width:100%;">
                            </div>
                        </div>
                    </div>
                    <div style="background:#23283a;border-radius:10px;padding:18px 18px 8px 18px;box-shadow:0 2px 8px #0002;">
                        <div style="font-weight:600;margin-bottom:0.5em;">Opțiuni suplimentare</div>
                        <textarea id="itemNote" placeholder="Note" style="width:100%;margin-bottom:12px;padding:10px 12px;border-radius:7px;border:none;background:#191b26;color:#e3e6f3;font-size:1rem;outline:none;"></textarea>
                    </div>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:2em;gap:18px;">
                        <button type="submit" class="btn-primary" style="padding:10px 32px;background:#1976d2;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:1em;box-shadow:0 2px 8px #1976d255;">Salvare</button>
                        <button type="button" class="btn-secondary" id="cancelBtn" style="padding:10px 18px;background:#2d2323;color:#ff5252;border:none;border-radius:8px;cursor:pointer;font-size:1.1em;font-weight:600;">Anulare</button>
                    </div>
                </form>
            </div>`;
            document.body.appendChild(modalBg);
            // Funcționalitate show/hide parolă
            document.getElementById('pwToggleBtn').onclick = function(e) {
                e.preventDefault();
                const pw = document.getElementById('itemPassword');
                if (pw.type === 'password') { pw.type = 'text'; this.textContent = '🙈'; }
                else { pw.type = 'password'; this.textContent = '👁️'; }
            };
            // Generator demo parolă
            document.getElementById('pwGenBtn').onclick = function(e) {
                e.preventDefault();
                const pw = Math.random().toString(36).slice(-10) + Math.random().toString(36).slice(-5);
                document.getElementById('itemPassword').value = pw;
            };
            // Închidere
            document.getElementById('cancelBtn').onclick = function(e) {
                e.preventDefault();
                modalBg.remove();
            };
            // Salvare articol nou
            document.getElementById('addItemForm').onsubmit = function(e) {
                e.preventDefault();
                const passwords = JSON.parse(localStorage.getItem('passwords')||'[]');
                const now = new Date();
                const newItem = {
                    id: Date.now(),
                    denumire: document.getElementById('itemName').value,
                    proprietar: 'Eu',
                    tip: 'Conectare',
                    username: document.getElementById('itemUser').value,
                    parola: document.getElementById('itemPassword').value,
                    saitweb: document.getElementById('itemSite').value,
                    detalii: document.getElementById('itemNote').value,
                    istoric: [{ actiune: 'creat', data: now.toLocaleString() }],
                    lastEdited: now.toLocaleString(),
                    created: now.toLocaleString()
                };
                passwords.push(newItem);
                localStorage.setItem('passwords', JSON.stringify(passwords));
                modalBg.remove();
                if (typeof renderPasswords === 'function') {
                    renderPasswords(passwords);
                } else {
                    location.reload();
                }
            };
        });

        // Dialog modern pentru creare articol (stil Bitwarden)
    </script>
</body>
</html>
